# koishi-plugin-menu

[![npm](https://img.shields.io/npm/v/koishi-plugin-menu?style=flat-square)](https://www.npmjs.com/package/koishi-plugin-menu)

可自定义的帮助菜单，提供美观的可视化命令帮助界面

## 功能特性

- 🎨 **美观的界面设计** - 现代化的卡片布局，渐变背景和圆角设计
- 📱 **响应式布局** - 自适应移动端和桌面端显示，支持网格布局
- 🌐 **多语言支持** - 支持 Koishi 的国际化系统
- 🔧 **灵活的数据源** - 支持文件缓存和内存实时读取两种模式
- 🎯 **智能权限过滤** - 自动过滤用户无权限的命令和选项
- 📦 **智能命令管理** - 支持命令分组、隐藏选项和子命令展示
- 🖼️ **图片渲染** - 基于 Puppeteer 的高质量图片输出
- 🔍 **详情页支持** - 显示命令的详细用法、选项和示例
- ⚡ **智能缓存** - 支持图片缓存，提升响应速度
- 🎛️ **高度可定制** - 支持自定义 CSS、网格布局和卡片尺寸

## 使用方法

```text
menu              # 显示所有可用命令的菜单
menu <命令名>      # 显示指定命令的详细信息
menu -H           # 显示所有命令和选项（包括隐藏项）
menu -c           # 清理缓存并重新生成
menu <命令名> -c   # 清理指定命令的缓存并重新生成
```

## 配置选项

### 数据源配置

- **source**: 命令数据源类型
  - `inline`: 内存实时读取，数据更新及时 (默认)
  - `file`: 本地文件缓存，性能更好
- **enableCache**: 是否启用图片缓存 (默认 true)

### 样式配置

- **padding**: 内边距大小，单位 px (默认 16)
- **radius**: 圆角大小，单位 px (默认 12)
- **fontSize**: 基础字体大小，单位 px (默认 24)
- **titleSize**: 标题字体大小倍数 (默认 2)
- **cardWidth**: 命令卡片宽度，单位 px (默认 200)
- **cardHeight**: 命令卡片高度，单位 px (默认 120)
- **gridColumns**: 网格列数 (默认 4)

### 页面配置

- **fontlink**: 自定义字体的 URL 链接
- **bgimg**: 背景图片文件名或完整 URL 地址
- **header**: 页头 HTML 内容
- **footer**: 页脚 HTML 内容 (默认为空)
- **customCss**: 自定义 CSS 样式

### 颜色配置

- **primary**: 主色调 (默认 #8b5cf6)
- **secondary**: 副色调 (默认 #38bdf8)
- **bgColor**: 背景色 (默认 #fefefe)
- **textColor**: 文本色 (默认 #64748b)

## 高级功能

### 自动命令调用

当用户输入没有 action 的命令时，插件会自动调用 `menu <命令名>` 显示该命令的详细帮助。

### 智能缓存系统

- 基于命令内容和配置生成唯一缓存键
- 支持按命令名称清理特定缓存
- 缓存文件存储在 `data/menu/cache/` 目录
- 可通过 `-c` 选项强制刷新缓存

### 文件存储

- 命令数据存储在 `data/menu/commands.json` 或 `data/menu/commands-<locale>.json`
- 支持本地资源文件，图片路径会自动转换为 `file://` 协议
- 缓存图片存储在 `data/menu/cache/` 目录

### 权限系统

插件会根据用户权限自动过滤：

- 无权限的命令不会显示
- 隐藏的命令和选项可通过 `-H` 参数显示
- 支持选项级别的权限控制

## 注意事项

1. 使用文件模式时，首次加载可能较慢，之后会缓存数据
2. 背景图片建议使用较浅的颜色以确保文字可读性
3. 自定义字体需要确保 URL 可访问
4. 页头和页脚支持 HTML 格式，请注意安全性
5. 缓存文件会根据内容变化自动更新
6. 网格布局会根据卡片宽度和列数自动调整
